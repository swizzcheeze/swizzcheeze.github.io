<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fabric Patterns Documentation - Refined Dark Theme</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/5.1.0/github-markdown-dark.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark-dimmed.min.css"> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <style>
        :root {
            /* --- Refined Dark Theme Colors for Seamlessness --- */
            --primary-color: #58A6FF;       /* Bright Blue Accent */
            --secondary-color: #F78166;    /* Orange Accent */
            --text-color: #ADBAC7;          /* Primary Light Text (slightly softer) */
            --text-light: #768390;         /* Secondary Grey Text (softer) */
            --bg-color: #0A0C10;           /* Deepest Background */
            --header-bg: #11151C;          /* Header Background */
            --sidebar-bg: #11151C;         /* Sidebar Background (Match Header) */
            --card-bg: #161B22;            /* Card Background (Slightly lighter) */
            --code-bg: #1C2128;            /* Code Background (Subtle difference) */
            --border-color: #2A2F37;        /* Softer Border */
            --hover-bg: #21262D;           /* Background for hover states */
            --upvote-color: var(--secondary-color);
            --downvote-color: var(--primary-color);
            --header-text: #DDE4ED;         /* Very Light Header/Heading Text */
            --link-color: var(--primary-color);
            --shadow-color-light: rgba(0, 0, 0, 0.2); /* Lighter shadow for subtle depth */
            --shadow-color-dark: rgba(0, 0, 0, 0.4);  /* Darker shadow for hover */
            --card-shadow: 0 2px 5px var(--shadow-color-light);
            --card-shadow-hover: 0 4px 10px var(--shadow-color-dark);
            --card-radius: 6px;
        }
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            font-size: 15px;
        }
        .container {
            max-width: 1150px; /* Slightly wider container */
            margin: 0 auto;
            padding: 20px 25px; /* Adjust padding */
            background-color: var(--bg-color);
        }
        header {
            background-color: var(--header-bg);
            color: var(--header-text);
            padding: 12px 25px; /* Adjusted padding */
            text-align: left;
            position: sticky;
            top: 0;
            z-index: 101;
            border-bottom: 1px solid var(--border-color);
        }
        header h1 { margin: 0; font-size: 1.7em; color: var(--header-text); display: inline-block; }
        header p { display: none; }
        nav {
            background-color: var(--header-bg); /* Match header */
            padding: 8px 25px; /* Adjusted padding */
            position: sticky;
            top: 59px; /* Adjust based on header height */
            z-index: 100;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 1px 3px var(--shadow-color-light);
        }
        nav ul { list-style-type: none; margin: 0; padding: 0; display: flex; flex-wrap: wrap; }
        nav li { margin-right: 18px; margin-bottom: 5px; } /* Increased spacing */
        nav a { color: var(--text-color); text-decoration: none; font-weight: 600; transition: color 0.2s; font-size: 0.95em; }
        nav a:hover, nav a:focus { color: var(--link-color); text-decoration: underline; }

        /* Markdown Body Styling */
        .markdown-body { padding: 0; font-size: 1em; color: var(--text-color); background-color: transparent; }
        .markdown-body h1, .markdown-body h2, .markdown-body h3, .markdown-body h4 { color: var(--header-text); border-bottom-color: var(--border-color); padding-bottom: 0.4em; margin-top: 1.8em; margin-bottom: 0.8em; }
        .markdown-body h2 { font-size: 1.6em; }
        .markdown-body h3 { font-size: 1.3em; border-bottom: none; }
        .markdown-body a { color: var(--link-color); }
        .markdown-body a:hover { text-decoration: underline; }
        .markdown-body code:not([class*="language-"]) { background-color: var(--code-bg); padding: 0.25em 0.5em; border-radius: 4px; font-size: 0.9em; color: var(--text-color); border: 1px solid var(--border-color); }

        /* Code Block Handling - Prevent Horizontal Scroll */
        .markdown-body pre {
            background-color: var(--code-bg);
            border-radius: var(--card-radius);
            padding: 16px;
            overflow: auto; /* Fallback for browsers not supporting wrap */
            border: 1px solid var(--border-color);
            position: relative;
            white-space: pre-wrap;       /* Wrap long lines */
            word-wrap: break-word;      /* Break long words/strings if necessary */
        }
        .markdown-body pre code {
           background-color: transparent;
           padding: 0;
           font-size: 0.9em;
           white-space: pre-wrap;   /* Ensure code inside also wraps */
           word-wrap: break-word;   /* Redundant but safe */
           color: inherit; /* Inherit color from theme */
        }

         /* Pattern Card Styling */
        .pattern-card {
            border: 1px solid var(--border-color);
            border-radius: var(--card-radius);
            margin: 18px 0; /* Increased spacing */
            background-color: var(--card-bg);
            box-shadow: var(--card-shadow);
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            padding: 0;
        }
        .pattern-card:hover {
            border-color: var(--primary-color);
            box-shadow: var(--card-shadow-hover);
        }
        .voting {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px 10px 10px; /* Adjusted padding */
            background-color: var(--header-bg); /* Darker voting area */
            border-right: 1px solid var(--border-color);
            border-top-left-radius: var(--card-radius);
            border-bottom-left-radius: var(--card-radius);
        }
        .upvote, .downvote {
            width: 30px; height: 30px; /* Slightly larger buttons */
            background: none; border: none; cursor: pointer; margin: 4px 0;
            color: var(--text-light); line-height: 1; padding: 3px;
            display: flex; align-items: center; justify-content: center;
            border-radius: 4px; transition: background-color 0.2s, color 0.2s;
        }
        .upvote svg, .downvote svg { width: 20px; height: 20px; fill: currentColor; }
        .upvote:hover, .upvote:focus { color: var(--upvote-color); background-color: rgba(247, 129, 102, 0.1); }
        .downvote:hover, .downvote:focus { color: var(--downvote-color); background-color: rgba(88, 166, 255, 0.1); }
        .vote-count { font-size: 0.9em; font-weight: bold; margin: 8px 0; color: var(--text-color); }

        .pattern-main { padding: 18px 22px; flex-grow: 1; }
        .pattern-main h3 { margin-top: 0; margin-bottom: 12px; color: var(--header-text); font-size: 1.25em; cursor: pointer; border-bottom: none; }
        .pattern-main h3:hover, .pattern-main h3:focus { color: var(--link-color); }
        .pattern-meta { display: flex; margin-bottom: 15px; flex-wrap: wrap; }
        .pattern-meta div { background-color: var(--code-bg); padding: 5px 12px; border-radius: var(--card-radius); margin-right: 8px; margin-bottom: 8px; font-size: 0.85em; color: var(--text-light); border: 1px solid var(--border-color); line-height: 1.4; }
        .pattern-main p { margin-bottom: 12px; font-size: 1em; color: var(--text-color); }
        .pattern-main p strong { color: var(--header-text); font-weight: 600; }

        .copy-button {
            position: absolute; top: 10px; right: 10px; background-color: var(--border-color); /* Use border color */
            color: var(--text-light); border: 1px solid var(--border-color); border-radius: var(--card-radius);
            padding: 4px 8px; cursor: pointer; font-size: 0.8em; opacity: 0.7;
            transition: opacity 0.2s, background-color 0.2s, color 0.2s;
        }
        .copy-button:hover, .copy-button:focus { background-color: var(--hover-bg); opacity: 1; color: var(--header-text); }
        .copy-button.copied { background-color: #238636; border-color: #2ea043; color: white; opacity: 1; }

        footer { text-align: center; padding: 25px; background-color: var(--bg-color); color: var(--text-light); margin-top: 35px; font-size: 0.9em; border-top: 1px solid var(--border-color); }
        footer a { color: var(--link-color); text-decoration: underline; }
        footer a:hover, footer a:focus { color: #79c0ff; }

        .github-corner { position: absolute; top: 0; right: 0; border: 0; fill: var(--primary-color); color: var(--bg-color); }

        .pattern-section { margin-bottom: 35px; }
        .category-section { background-color: var(--card-bg); border-radius: var(--card-radius); padding: 20px 25px; margin-bottom: 25px; box-shadow: var(--card-shadow); border: 1px solid var(--border-color); }
        .category-section h2 { margin-top: 0; border-bottom: 1px solid var(--border-color); padding-bottom: 12px; font-size: 1.5em; }
        .category-section h3 { font-size: 1.3em; margin-top: 1.8em; margin-bottom: 1em; border-bottom: none; padding-bottom: 0; color: var(--header-text); }
        .category-content { display: flex; flex-wrap: wrap; margin-top: 12px; }
        .tag { display: inline-block; background-color: var(--code-bg); padding: 5px 12px; border-radius: var(--card-radius); margin-right: 8px; margin-bottom: 8px; font-size: 0.85em; color: var(--text-light); cursor: default; border: 1px solid var(--border-color); }

        /* Sidebar / TOC Upgrade */
        .sticky-toc {
            position: sticky; top: 115px; /* Adjust based on header/nav height */
            background-color: var(--sidebar-bg); /* Match header */
            border-radius: var(--card-radius);
            padding: 20px; /* More padding */
            box-shadow: var(--card-shadow);
            max-height: calc(100vh - 140px);
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }
         /* Custom scrollbar for TOC */
         .sticky-toc::-webkit-scrollbar { width: 8px; }
         .sticky-toc::-webkit-scrollbar-track { background: var(--sidebar-bg); border-radius: var(--card-radius);}
         .sticky-toc::-webkit-scrollbar-thumb { background-color: var(--border-color); border-radius: 4px; border: 2px solid var(--sidebar-bg); }
         .sticky-toc::-webkit-scrollbar-thumb:hover { background-color: var(--text-light); }

        .sticky-toc h3 { margin-top: 0; font-size: 1.15em; color: var(--header-text); border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 10px; }
        .sticky-toc ul { list-style-type: none; padding-left: 0; margin: 0; }
        .sticky-toc > ul > li { padding: 5px 0; font-weight: 600; color: var(--header-text); font-size: 0.95em; }
        .sticky-toc ul ul { padding-left: 18px; margin-top: 5px; margin-bottom: 10px; } /* Increased indent */
        .sticky-toc li { padding: 3px 0; } /* Spacing between items */
        .sticky-toc a {
            color: var(--text-color); text-decoration: none; font-size: 0.9em; /* Slightly smaller font for links */
            display: block; padding: 6px 10px; /* More padding */
            border-radius: 4px; transition: background-color 0.2s, padding-left 0.2s, color 0.2s;
            font-weight: normal; outline: none; word-break: break-word; /* Allow wrapping */
        }
        .sticky-toc a:hover { background-color: var(--hover-bg); padding-left: 14px; color: var(--primary-color); }
        .sticky-toc a:focus { box-shadow: 0 0 0 2px var(--primary-color); background-color: var(--hover-bg); }
        .sticky-toc .active { color: var(--secondary-color); font-weight: 600; background-color: rgba(247, 129, 102, 0.1); border-left: 3px solid var(--secondary-color); padding-left: 7px; /* Adjusted padding */ }
        .sticky-toc .active:focus { box-shadow: 0 0 0 2px var(--secondary-color); }

        .page-layout { display: grid; grid-template-columns: 270px 1fr; gap: 30px; } /* Wider sidebar, wider gap */
        .main-content { grid-column: 2; min-width: 0; } /* Crucial for preventing grid blowout */
        .sidebar { grid-column: 1; }

        .toggle-example { background-color: var(--code-bg); color: var(--link-color); border: 1px solid var(--border-color); border-radius: var(--card-radius); padding: 6px 14px; margin-top: 12px; cursor: pointer; font-size: 0.85em; font-weight: 600; transition: background-color 0.2s, color 0.2s, border-color 0.2s; }
        .toggle-example:hover, .toggle-example:focus { background-color: var(--primary-color); color: var(--header-bg); border-color: var(--primary-color); outline: none; }
        .toggle-example.expanded { background-color: var(--primary-color); color: var(--header-bg); border-color: var(--primary-color); }
        .toggle-example:focus { box-shadow: 0 0 0 2px var(--primary-color); }
        .example-content { display: none; margin-top: 18px; padding-top: 18px; border-top: 1px dashed var(--border-color); }
        .example-content.show-example { display: block; }
        .example-content h4 { font-size: 1em; color: var(--text-light); margin-bottom: 10px; margin-top: 0; font-weight: 600; }

        /* Responsive Adjustments */
        @media (max-width: 1000px) { /* Wider breakpoint */
             .page-layout { grid-template-columns: 1fr; gap: 20px; } /* Stack earlier */
            .main-content, .sidebar { grid-column: 1; }
            .sticky-toc { position: static; max-height: none; margin-bottom: 25px; width: auto; }
             header h1 { font-size: 1.5em; }
             nav { top: 55px; /* Adjust if header height changed */ }
        }
        @media (max-width: 768px) {
            body { font-size: 14px; }
            .container { padding: 10px 15px; }
            header { padding: 10px 15px; position: static; }
            nav { position: static; padding: 5px 15px; }
            .github-corner { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <h1>Fabric Patterns</h1>
         <a href="https://github.com/YOUR_GITHUB_USERNAME/fabric-patterns" class="github-corner" aria-label="View on GitHub"><svg width="60" height="60" viewBox="0 0 250 250" style="position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>
    </header>

    <nav>
         <ul>
             <li><a href="#what-is-fabric">What is Fabric?</a></li>
            <li><a href="#writing-patterns">Writing</a></li>
            <li><a href="#analysis-patterns">Analysis</a></li>
            <li><a href="#summarization-patterns">Summarization</a></li>
             <li><a href="#extraction-patterns">Extraction</a></li>
             <li><a href="#creation-patterns">Creation</a></li>
             <li><a href="#code-patterns">Code</a></li>
             <li><a href="#specialized-patterns">Specialized</a></li>
            <li><a href="#contributing">Contributing</a></li>
            <li><a href="#resources">Resources</a></li>
        </ul>
    </nav>

    <div class="container">
        <div class="page-layout">
            <div class="sidebar">
                <div class="sticky-toc">
                    <h3>Contents</h3>
                     <ul>
                        <li><a href="#what-is-fabric">What is Fabric</a></li>
                        <li><a href="#writing-patterns">Writing Patterns</a>
                            </li>
                        <li><a href="#pattern-categories">Pattern Categories</a>
                             <ul>
                                 <li><a href="#analysis-patterns">Analysis</a>
                                     </li>
                                 <li><a href="#summarization-patterns">Summarization</a></li>
                                 <li><a href="#extraction-patterns">Extraction</a></li>
                                 <li><a href="#creation-patterns">Creation</a></li>
                                 <li><a href="#code-patterns">Code</a></li>
                                 <li><a href="#specialized-patterns">Specialized</a></li>
                             </ul>
                        </li>
                        <li><a href="#pattern-combinations">Pattern Combinations</a></li>
                        <li><a href="#contributing">Contributing</a></li>
                        <li><a href="#resources">Resources</a></li>
                    </ul>
                </div>
            </div>

            <div class="main-content">
                <article class="markdown-body">
                    <div class="category-section" id="what-is-fabric">
                         <h2>What is Fabric?</h2>
                         <p>Fabric is an AI-based tool created by Daniel Miessler that provides a library of "patterns" - specialized templates for processing different types of information using AI models...</p>
                         <h3>Key Features</h3>
                          <div class="category-content">
                              <span class="tag">200+ Specialized Patterns</span>
                              <span class="tag">Multiple AI Model Support</span>
                              <span class="tag">Consistent Output Formats</span>
                              <span class="tag">Command-Line Interface</span>
                              <span class="tag">Extensible Design</span>
                          </div>
                           <h3>How Fabric Works</h3>
                           <p>Fabric works by combining your input data (like text, code, or URLs) with a pre-defined 'pattern' (a specialized system prompt). This combined information is then sent to an AI model (like GPT-4, Claude 3, etc.) to generate a structured output based on the pattern's instructions.</p>
                           <h3>Installation and Setup</h3>
                           <pre><code class="language-bash"># Clone the repository
 git clone https://github.com/danielmiessler/fabric.git

 # Navigate to the directory
 cd fabric

 # Install dependencies (usually involves pip)
 pip install -r requirements.txt

 # Set up your API keys (follow README instructions)
 # Example: export OPENAI_API_KEY='your_key_here'

 # Run Fabric
 fabric --list # List available patterns
 fabric -p summarize -d "Your text here" # Use a pattern</code><button class="copy-button" title="Copy Code">Copy</button></pre>
                          <p>For more detailed installation instructions, visit the <a href="https://github.com/danielmiessler/fabric">official Fabric repository</a>.</p>
                     </div>

                     <div class="pattern-section" id="writing-patterns">
                         <h2>Writing Patterns</h2>
                         <p>Patterns designed specifically for content creation and writing tasks, often mimicking specific styles or formats.</p>
                         <div class="pattern-card" id="write_essay">
                              <div class="voting">
                                  <button class="upvote" title="Upvote" aria-label="Upvote"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 4 3 15h6v5h6v-5h6z"/></svg></button>
                                  <span class="vote-count">124</span>
                                  <button class="downvote" title="Downvote" aria-label="Downvote"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 20l9-11h-6V4H9v5H3z"/></svg></button>
                              </div>
                              <div class="pattern-main">
                                 <h3>write_essay</h3>
                                 <div class="pattern-meta">
                                     <div>Content Creation</div>
                                     <div>Essay Writing</div>
                                     <div>Paul Graham Style</div>
                                 </div>
                                 <p><strong>Purpose:</strong> Writes concise, clear essays in the style of Paul Graham.</p>
                                 <p>This pattern generates essays focused on simplicity, clarity, and illuminating insights, similar to the influential essays by Paul Graham on startups, technology, and thinking.</p>
                                 <button class="toggle-example" data-target="essay-example">Show Example ▼</button>
                                 <div id="essay-example" class="example-content">
                                     <h4>Example Command:</h4>
                                      <pre><code class="language-bash">fabric -p write_essay -d "The impact of AI on knowledge work jobs"</code><button class="copy-button" title="Copy Code">Copy</button></pre>
                                     <h4>Example Output:</h4>
                                     <pre><code class="language-markdown"># The Impact of AI on Knowledge Work Jobs

 Artificial intelligence is rapidly reshaping the landscape of knowledge work...
 ...</code><button class="copy-button" title="Copy Code">Copy</button></pre>
                                 </div>
                             </div>
                          </div>
                          </div>

                     <div class="category-section" id="pattern-categories">
                         <h2>Pattern Categories</h2>
                          <p>The patterns in Fabric cover a wide range of tasks...</p>
                          <h3 id="analysis-patterns">Analysis Patterns</h3>
                          <p>Patterns focused on dissecting information...</p>
                           <div class="pattern-card" id="analyze_threat_report">
                                <div class="voting">
                                     <button class="upvote" title="Upvote" aria-label="Upvote"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 4 3 15h6v5h6v-5h6z"/></svg></button>
                                     <span class="vote-count">55</span>
                                     <button class="downvote" title="Downvote" aria-label="Downvote"><svg viewBox="0 0 24 24" aria-hidden="true"><path d="M12 20l9-11h-6V4H9v5H3z"/></svg></button>
                                 </div>
                                <div class="pattern-main">
                                     <h3>analyze_threat_report</h3>
                                     <div class="pattern-meta"> <div>Cybersecurity</div> <div>Threat Intelligence</div> <div>Report Analysis</div> <div>Insight Extraction</div> </div>
                                     <p><strong>Purpose:</strong> Extract surprising/insightful trends, statistics, quotes, references, and recommendations from cyber threat reports.</p>
                                 </div>
                            </div>
                          </div>

                    </article>
            </div>
        </div>
    </div>

    <footer>
         <p>Created with ❤️ by the community | <a href="https://github.com/YOUR_GITHUB_USERNAME/fabric-patterns" target="_blank" rel="noopener noreferrer">View on GitHub</a></p>
          <p><em>This documentation is a community project and is not officially affiliated with Daniel Miessler or the Fabric project unless otherwise stated.</em></p>
    </footer>

    <script>
        // JS functions (setupToggleExample, setupCopyButtons, setupToc, addTocLinksDynamically, handleToggleClick, handleCopyClick) remain the same
         // Apply syntax highlighting after page load
         document.addEventListener('DOMContentLoaded', (event) => {
             // Initialize highlight.js
             hljs.highlightAll();

             // --- Interactivity Scripts ---
             setupToggleExample();
             setupCopyButtons();
             setupToc(); // Setup TOC after DOM is ready
         });

        // Function to setup example toggles
        function setupToggleExample() {
            document.querySelectorAll('.toggle-example').forEach(button => {
                button.removeEventListener('click', handleToggleClick); // Remove previous listener if any
                button.addEventListener('click', handleToggleClick);
                // Set initial ARIA states
                const targetId = button.getAttribute('data-target');
                const targetElement = document.getElementById(targetId);
                const isExpanded = targetElement ? targetElement.classList.contains('show-example') : false;
                button.setAttribute('aria-controls', targetId || '');
                button.setAttribute('aria-expanded', isExpanded);
                button.textContent = isExpanded ? 'Hide Example ▲' : 'Show Example ▼';
                button.classList.toggle('expanded', isExpanded);
            });
        }

        function handleToggleClick(event) {
            const button = event.currentTarget;
            const targetId = button.getAttribute('data-target');
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                const isExpanded = targetElement.classList.toggle('show-example');
                button.textContent = isExpanded ? 'Hide Example ▲' : 'Show Example ▼';
                button.setAttribute('aria-expanded', isExpanded);
                button.classList.toggle('expanded', isExpanded);
            }
        }

        // Function to setup copy buttons
        function setupCopyButtons() {
             document.querySelectorAll('.copy-button').forEach(button => {
                 button.removeEventListener('click', handleCopyClick); // Remove previous listener
                 button.addEventListener('click', handleCopyClick);
                 button.setAttribute('aria-label', 'Copy code'); // Set initial label
             });
        }

        function handleCopyClick(event) {
            const button = event.currentTarget;
            const pre = button.closest('pre');
            const code = pre ? pre.querySelector('code') : null;
            const textToCopy = code ? (code.textContent || code.innerText || '') : '';

            if (!textToCopy) {
                console.error('Could not find code to copy.');
                return;
            }

            navigator.clipboard.writeText(textToCopy).then(() => {
                button.textContent = 'Copied!';
                button.classList.add('copied');
                button.setAttribute('aria-label', 'Copied code');
                setTimeout(() => {
                    button.textContent = 'Copy';
                    button.classList.remove('copied');
                    button.setAttribute('aria-label', 'Copy code');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                 button.textContent = 'Error';
                 button.setAttribute('aria-label', 'Error copying code');
                 setTimeout(() => {
                    button.textContent = 'Copy';
                    button.setAttribute('aria-label', 'Copy code');
                }, 2000);
            });
        }


         // Function to setup TOC and Intersection Observer
        function setupToc() {
             let tocLinks = document.querySelectorAll('.sticky-toc a');
             const sections = document.querySelectorAll('.main-content h2[id], .main-content .category-section h3[id], .main-content .pattern-card[id]');
             let lastActiveLink = null;
             let tocScrollTimeout;

             // Check if IntersectionObserver is supported
             if (!('IntersectionObserver' in window)) {
                 console.warn('IntersectionObserver not supported, TOC highlighting disabled.');
                 return;
             }


             const observerOptions = {
                 rootMargin: "-20% 0px -70% 0px",
                 threshold: 0
             };

             const observer = new IntersectionObserver((entries) => {
                 let topmostVisibleEntry = null;
                 entries.forEach(entry => {
                     if (entry.isIntersecting) {
                         if (!topmostVisibleEntry || entry.boundingClientRect.top < topmostVisibleEntry.boundingClientRect.top) {
                             topmostVisibleEntry = entry;
                         }
                     }
                 });

                 if (topmostVisibleEntry) {
                     const id = topmostVisibleEntry.target.getAttribute('id');
                     // Find the link specifically within the TOC
                     const activeLink = document.querySelector(`.sticky-toc a[href="#${id}"]`);
                     if (activeLink && activeLink !== lastActiveLink) {
                         if(lastActiveLink) lastActiveLink.classList.remove('active');
                         activeLink.classList.add('active');
                         lastActiveLink = activeLink;
                         clearTimeout(tocScrollTimeout);
                         tocScrollTimeout = setTimeout(() => {
                              const toc = document.querySelector('.sticky-toc');
                              if (!toc) return;
                              const linkRect = activeLink.getBoundingClientRect();
                              const tocRect = toc.getBoundingClientRect();
                              // Check if link is outside the visible area of the TOC container
                              if (linkRect.top < tocRect.top || linkRect.bottom > tocRect.bottom) {
                                   activeLink.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                              }
                         }, 100);
                     }
                 }
             }, observerOptions);

             sections.forEach(section => {
                 if (section) observer.observe(section);
             });

             // Dynamically add TOC links
             addTocLinksDynamically('writing-patterns', '#writing-patterns .pattern-card[id]', '.sticky-toc a[href="#writing-patterns"]');
             addTocLinksDynamically('analysis-patterns', '#analysis-patterns + .pattern-card, #analysis-patterns ~ .pattern-card', '.sticky-toc a[href="#analysis-patterns"]');
             // Add calls for other sections as needed...
             addTocLinksDynamically('summarization-patterns', '#summarization-patterns + .pattern-card, #summarization-patterns ~ .pattern-card', '.sticky-toc a[href="#summarization-patterns"]');
              addTocLinksDynamically('extraction-patterns', '#extraction-patterns + .pattern-card, #extraction-patterns ~ .pattern-card', '.sticky-toc a[href="#extraction-patterns"]');
              addTocLinksDynamically('creation-patterns', '#creation-patterns + .pattern-card, #creation-patterns ~ .pattern-card', '.sticky-toc a[href="#creation-patterns"]');
              addTocLinksDynamically('code-patterns', '#code-patterns + .pattern-card, #code-patterns ~ .pattern-card', '.sticky-toc a[href="#code-patterns"]');
              addTocLinksDynamically('specialized-patterns', '#specialized-patterns + .pattern-card, #specialized-patterns ~ .pattern-card', '.sticky-toc a[href="#specialized-patterns"]');


             // Re-select tocLinks after dynamic addition for observer logic if needed (though unlikely necessary)
             // tocLinks = document.querySelectorAll('.sticky-toc a');
         }

        // Helper function to add TOC links dynamically
        function addTocLinksDynamically(sectionId, cardSelector, tocParentSelector) {
            const tocParentLi = document.querySelector(tocParentSelector);
            // It's possible the parent link itself doesn't exist yet if categories are added later
            if (!tocParentLi) {
                console.warn(`TOC parent selector not found: ${tocParentSelector}`);
                return;
            }

            let tocList = tocParentLi.querySelector('ul');
            if (!tocList) {
                tocList = document.createElement('ul');
                tocParentLi.appendChild(tocList);
            }

            const patternCards = document.querySelectorAll(cardSelector);
            if (patternCards.length === 0) {
                // console.log(`No cards found for selector: ${cardSelector}`);
            }

            patternCards.forEach(card => {
                const cardId = card.id;
                // Ensure ID exists and link is not already present
                if (!cardId || tocList.querySelector(`a[href="#${cardId}"]`)) {
                    return;
                }
                const cardTitleElement = card.querySelector('.pattern-main h3');
                if (cardTitleElement) {
                    const cardTitle = cardTitleElement.textContent;
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `#${cardId}`;
                    link.textContent = cardTitle;
                    listItem.appendChild(link);
                    tocList.appendChild(listItem);
                } else {
                     console.warn(`Card with ID ${cardId} is missing title element.`);
                }
            });
        }
    </script>
</body>
</html>